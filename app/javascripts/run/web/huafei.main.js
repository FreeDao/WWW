(function(a,b){var c=Object.prototype.toString,d=function(a,d,e){e=e||{};if(arguments.length>1&&c.call(d)!=="[object Object]"){if(d===null||d===undefined)e.expires=-1;if(c.call(e.expires)==="[object Number]"){var f=e.expires,g=e.expires=new Date;g.setDate(g.getDate()+f)}return d=String(d),b.cookie=[encodeURIComponent(a),"=",e.raw?d:encodeURIComponent(d),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("")}e=d||{};var h,i=e.raw?function(a){return a}:decodeURIComponent;return(h=(new RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)")).exec(b.cookie))?i(h[1]):null};a._.mixin({cookie:d})})(this,this.document),function(a,b){var c=a.document,d,e,f,g="你用安卓手机吧？豌豆荚知道吧？有个送话费活动，你装个豌豆荚咱俩都能赚话费！点这个下 ",h=Backbone.Router.extend({routes:{"":"home",input:"input",share:"share"},home:function(){$("#ctn .header").show(),e.$el.hide(),f.$el.hide(),d.$el.show()},input:function(){$("#ctn .header").show(),d.$el.hide(),f.$el.hide(),e.$el.show()},share:function(){$("#ctn .header").hide(),e.$el.hide(),d.$el.hide(),f.render().$el.show()}}),i=new h,j=Backbone.View.extend({template:_.template($("#tmpl-start").html()),className:"step-1",render:function(){return this.$el.html(this.template({})),this},clickButtonStart:function(){this.$el.hide(),i.navigate("input",{trigger:!0})},clickLink:function(){a.campaignPlugin.openInBrowser("http://help.wandoujia.com/entries/23074737")},events:{"click .button-start":"clickButtonStart","click .link":"clickLink"}});d=new j;var k=Backbone.View.extend({template:_.template($("#tmpl-input").html()),className:"step-2",render:function(){return this.$el.html(this.template({})),this},doSend:function(){this.$(".warn").hide();var a=this.$(".input-id").val().trim();if(!a)this.$(".input-id").focus();else if(a.length!==11)this.$(".warn").show();else{var b=["http://spring.services.wandoujia.com/apk"];b.push("?name="+encodeURIComponent(a)),b.push("&callback=?"),$.ajax({url:b.join(""),dataType:"jsonp",success:function(b){_.cookie("wdj-campain-id",a),_.cookie("wdj-campain-url",b.value),i.navigate("share",{trigger:!0})}})}},clickButtonSend:function(){this.doSend()},keyupInputId:function(a){a.keyCode===13&&this.doSend()},events:{"click .button-send":"clickButtonSend","keyup .input-id":"keyupInputId"}});e=new k;var l=Backbone.View.extend({template:_.template($("#tmpl-share").html()),className:"step-3",pullUserCreditAsync:function(){var a=$.Deferred(),b=["http://spring.services.wandoujia.com/profile"];b.push("?name="+_.cookie("wdj-campain-id")),b.push("&callback=?");var c=this;return $.ajax({url:b.join(""),dataType:"jsonp",timeout:1e4,success:function(b){var d=4+parseInt(b.value,10)*2;d>=200&&c.$(".tip .desc").hide(),c.$(".tip .count").html(d>=200?200:d),a.resolve(b)},error:function(b){a.reject(b)}}).always(function(){setTimeout(function(){c.pullUserCreditAsync()},15e3)}),a.promise()},render:function(){var a=_.cookie("wdj-campain-url");return this.$el.html(this.template({})),this.$(".qrcode").qrcode({width:180,height:180,text:decodeURIComponent(a)}),this.$(".link").html(a).attr({href:a}),_.cookie("wdj-campain-id")&&this.pullUserCreditAsync(),this},clickButtonSMS:function(){a.campaignPlugin.openInBrowser("sms:?body="+g+_.cookie("wdj-campain-url"))},clickButtonWeibo:function(){var b=encodeURIComponent("豌豆荚最近有个送话费的活动，大家去装个 @豌豆荚，我们就都能赚话费！点这里下载："+_.cookie("wdj-campain-url"));$.ajax({url:"http://social-services.wandoujia.com/getPic?content="+encodeURIComponent(_.cookie("wdj-campain-url")),success:function(c){var d=encodeURIComponent(c),e="http://service.weibo.com/share/share.php?appkey=1483181040&relateUid=1727978503&title="+b+"&url=&pic="+d;a.campaignPlugin.openInBrowser(e)}})},clickButtonShare:function(){var b=encodeURIComponent("https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl="+_.cookie("wdj-campain-url")+"&chld=L|1&choe=UTF-8");a.campaignPlugin.share("装豌豆荚送话费",g+_.cookie("wdj-campain-url"))},clickLinkHelp:function(){a.campaignPlugin.openInBrowser("http://help.wandoujia.com/entries/23074737")},events:{"click .button-sms":"clickButtonSMS","click .button-weibo":"clickButtonWeibo","click .button-share":"clickButtonShare","click .link-help":"clickLinkHelp"}});f=new l;var m=c.createDocumentFragment();m.appendChild(d.render().$el[0]),m.appendChild(e.render().$el[0]),m.appendChild(f.$el[0]),$(".content").append(m),Backbone.history.start();var n=_.cookie("wdj-campain-id");n&&i.navigate("share",{trigger:!0})}(this);